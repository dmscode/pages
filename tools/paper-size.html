<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手账尺寸对照手册 | Stationery Size Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #fafaf9;
            background-image: 
                radial-gradient(#e7e5e4 1px, transparent 1px),
                radial-gradient(#e7e5e4 1px, transparent 1px);
            background-size: 24px 24px;
            background-position: 0 0, 12px 12px;
        }
        
        .paper-texture {
            background-color: #fefdfb;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
        }

        .handwritten {
            font-family: 'Courier New', cursive, monospace;
            letter-spacing: -0.5px;
        }

        .binder-hole {
            width: 8px;
            height: 8px;
            background: #d6d3d1;
            border-radius: 50%;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
        }

        .wash-tape {
            position: relative;
            opacity: 0.9;
        }
        
        .wash-tape::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 20%;
            width: 60%;
            height: 24px;
            background: repeating-linear-gradient(
                45deg,
                rgba(255,255,255,0.3),
                rgba(255,255,255,0.3) 5px,
                transparent 5px,
                transparent 10px
            );
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transform: rotate(-1deg);
        }

        .size-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .size-card:hover {
            transform: translateY(-2px) rotate(0.5deg);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02);
        }

        .grid-lines {
            background-image: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 23px,
                #e5e5e5 24px
            );
            background-size: 100% 24px;
        }

        .dot-grid {
            background-image: radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .comparison-canvas {
            position: relative;
            background: #f5f5f4;
            border: 1px dashed #d6d3d1;
            overflow: visible;
        }

        .a4-sheet {
            position: absolute;
            background: #ffffff;
            border: 1px solid #d1d5db;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 0.75rem;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .compare-item {
            position: absolute;
            background: rgba(251, 146, 60, 0.7);
            border: 2px solid #ea580c;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            cursor: grab;
            touch-action: none;
            user-select: none;
        }

        .compare-item.dragging {
            cursor: grabbing;
            box-shadow: 0 10px 18px rgba(0,0,0,0.15);
        }

        .nesting-rect {
            box-sizing: border-box;
        }

        /* 盐系配色类 */
        .salt-pink { background-color: #faf5f5; border-color: #f5e6e8; }
        .salt-blue { background-color: #f5f7fa; border-color: #e6eef5; }
        .salt-green { background-color: #f5faf7; border-color: #e6f0ea; }
        .salt-yellow { background-color: #faf9f5; border-color: #f5f0e6; }
        .salt-purple { background-color: #f8f5fa; border-color: #f0e6f5; }
        .salt-orange { background-color: #faf6f3; border-color: #f5ebe6; }

        .neo-tag {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(0,0,0,0.05);
        }

        @media print {
            .no-print { display: none; }
            .shadow-lg { box-shadow: none; }
        }
    </style>
</head>
<body class="text-stone-600 leading-relaxed antialiased">

    <!-- 顶部导航 -->
    <header class="sticky top-0 z-50 bg-stone-50/90 backdrop-blur-md border-b border-stone-200">
        <div class="max-w-6xl mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-stone-200 flex items-center justify-center handwritten font-bold text-stone-600 text-lg">D</div>
                <div>
                    <h1 class="text-xl font-medium text-stone-800 tracking-wide">手账尺寸对照手册</h1>
                    <p class="text-xs text-stone-400">Stationery Size Reference Guide</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="搜索尺寸..." 
                           class="pl-9 pr-4 py-2 rounded-full bg-white border border-stone-200 text-sm focus:outline-none focus:ring-2 focus:ring-stone-300 w-48 transition-all">
                    <svg class="w-4 h-4 text-stone-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <button onclick="toggleView('grid')" class="p-2 rounded-lg hover:bg-stone-200 transition-colors" title="网格视图">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>
                </button>
                <button onclick="toggleView('table')" class="p-2 rounded-lg hover:bg-stone-200 transition-colors" title="表格视图">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- 尺寸对比模块 -->
    <section class="max-w-6xl mx-auto px-4 pt-8 pb-4">
        <div class="paper-texture rounded-2xl p-6 shadow-sm border border-stone-100 wash-tape">
            <h2 class="text-lg font-medium text-stone-800 mb-4 flex items-center gap-2 handwritten">
                <span class="w-2 h-2 rounded-full bg-stone-400"></span>
                尺寸对比模块（A4 参照）
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-3">
                    <select id="compareSize" class="w-full p-3 rounded-lg border border-stone-200 bg-white text-sm focus:outline-none focus:border-stone-400">
                        <option value="">选择手账尺寸进行对比...</option>
                    </select>
                    <div class="flex flex-wrap gap-2 items-center">
                        <span class="text-xs text-stone-500">参照物：</span>
                        <select id="referenceSelect" class="flex-1 min-w-[180px] p-2.5 rounded-lg border border-stone-200 bg-white text-sm focus:outline-none focus:border-stone-400">
                            <option value="">选择参照物...</option>
                        </select>
                    </div>
                    <div class="flex flex-wrap gap-2 items-center">
                        <span class="text-xs text-stone-500">方向：</span>
                        <button onclick="setA4Orientation('portrait')" id="btnA4Portrait" class="px-3 py-1.5 rounded-lg text-xs border border-stone-200 bg-stone-800 text-white transition-colors">竖向</button>
                        <button onclick="setA4Orientation('landscape')" id="btnA4Landscape" class="px-3 py-1.5 rounded-lg text-xs border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 transition-colors">横向</button>
                        <button onclick="resetComparePosition()" class="ml-auto px-3 py-1.5 rounded-lg text-xs border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 transition-colors">重置位置</button>
                    </div>
                    <div class="text-xs text-stone-500 space-y-1">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-5 bg-white border border-gray-300"></div>
                        <span id="referenceLegendText">A4 打印纸（210×297 mm）</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-5 bg-orange-400/70 border-2 border-orange-600"></div>
                            <span>选中的手账尺寸（可拖动）</span>
                        </div>
                        <p class="text-stone-400 italic">提示：拖动橙色手账，支持超出 A4 纸范围以便对比</p>
                    </div>
                </div>
                <div class="comparison-canvas rounded-lg h-80 md:h-96" id="comparisonCanvas">
                    <div id="a4Sheet" class="a4-sheet">
                        <span class="text-xs font-medium" id="referenceSheetName">A4 纸</span>
                        <span class="text-[10px]" id="referenceSheetSize">210×297</span>
                    </div>
                    <div id="compareItem" class="compare-item hidden"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- 快速筛选标签 -->
    <div class="max-w-6xl mx-auto px-4 py-6">
        <div class="flex flex-wrap gap-2 justify-center no-print">
            <button onclick="filterByType('all')" class="filter-btn active px-4 py-2 rounded-full text-sm border border-stone-300 bg-stone-800 text-white shadow-sm transition-all hover:shadow-md" data-type="all">全部</button>
            <button onclick="filterByType('tn')" class="filter-btn px-4 py-2 rounded-full text-sm border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 transition-all" data-type="tn">TN 系列</button>
            <button onclick="filterByType('large')" class="filter-btn px-4 py-2 rounded-full text-sm border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 transition-all" data-type="large">大型(A5+)</button>
            <button onclick="filterByType('medium')" class="filter-btn px-4 py-2 rounded-full text-sm border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 transition-all" data-type="medium">中型(A6家族)</button>
            <button onclick="filterByType('small')" class="filter-btn px-4 py-2 rounded-full text-sm border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 transition-all" data-type="small">小型(A7/A8)</button>
            <button onclick="filterByType('fold')" class="filter-btn px-4 py-2 rounded-full text-sm border border-stone-200 bg-white text-stone-600 hover:bg-stone-50 transition-all" data-type="fold">折页</button>
            <button onclick="filterByType('compatible')" class="filter-btn px-4 py-2 rounded-full text-sm border border-rose-200 bg-rose-50 text-rose-600 hover:bg-rose-100 transition-all" data-type="compatible">⚡ 高兼容</button>
        </div>
    </div>

    <!-- 主要内容区 -->
    <main class="max-w-6xl mx-auto px-4 pb-20">
        
        <!-- 联动关系可视化 -->
        <section class="mb-12 paper-texture rounded-2xl p-6 shadow-sm border border-stone-100 wash-tape">
            <h2 class="text-lg font-medium text-stone-800 mb-4 flex items-center gap-2 handwritten">
                <span class="w-2 h-2 rounded-full bg-stone-400"></span>
                套娃收纳关系图
            </h2>
            <div class="overflow-x-auto">
                <div class="flex items-end gap-1 min-w-max pb-4" id="nestingChart">
                    <!-- 动态生成 -->
                </div>
            </div>
            <p class="text-xs text-stone-400 mt-2 italic">点击尺寸查看可收纳的小尺寸内页</p>
        </section>

        <!-- 尺寸卡片网格 -->
        <div id="sizeGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <!-- 卡片由JS生成 -->
        </div>

        <!-- 对照工具区 -->
        <section class="grid md:grid-cols-2 gap-6 mb-12">
            <!-- 折页计算器 -->
            <div class="paper-texture rounded-2xl p-6 shadow-sm border border-stone-100">
                <h3 class="text-lg font-medium text-stone-800 mb-4 handwritten flex items-center gap-2">
                    <svg class="w-5 h-5 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                    折页尺寸计算器
                </h3>
                <div class="space-y-3">
                    <select id="calcSize" class="w-full p-3 rounded-lg border border-stone-200 bg-white text-sm focus:outline-none focus:border-stone-400">
                        <option value="">选择基础尺寸...</option>
                    </select>
                    <div class="flex gap-2">
                        <button onclick="calcFold('bifold')" class="flex-1 py-2 rounded-lg bg-stone-100 hover:bg-stone-200 text-stone-700 text-sm transition-colors">二折页</button>
                        <button onclick="calcFold('trifold')" class="flex-1 py-2 rounded-lg bg-stone-100 hover:bg-stone-200 text-stone-700 text-sm transition-colors">三折页</button>
                    </div>
                    <div id="calcResult" class="hidden mt-4 p-4 bg-stone-50 rounded-lg text-sm border border-stone-200">
                        <!-- 结果 -->
                    </div>
                </div>
            </div>

            <!-- 孔位对照 -->
            <div class="paper-texture rounded-2xl p-6 shadow-sm border border-stone-100">
                <h3 class="text-lg font-medium text-stone-800 mb-4 handwritten flex items-center gap-2">
                    <svg class="w-5 h-5 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/></svg>
                    孔位体系速查
                </h3>
                <div class="space-y-4">
                    <div class="flex items-start gap-3 p-3 rounded-lg bg-white border border-stone-200">
                        <div class="flex flex-col gap-1 mt-1">
                            <div class="w-2 h-2 rounded-full bg-stone-300"></div>
                            <div class="w-2 h-2 rounded-full bg-stone-300"></div>
                            <div class="w-2 h-2 rounded-full bg-stone-300"></div>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-stone-800">欧美6孔标准</div>
                            <div class="text-xs text-stone-500 mt-1">19mm间距 | A5/Personal/A6/A7通用</div>
                            <div class="text-xs text-rose-500 mt-1">⚠️ 与日系20孔不兼容</div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 rounded-lg bg-white border border-stone-200">
                        <div class="flex flex-col gap-[2px] mt-1">
                            <div class="w-1.5 h-1.5 rounded-full bg-stone-300"></div>
                            <div class="w-1.5 h-1.5 rounded-full bg-stone-300"></div>
                            <div class="w-1.5 h-1.5 rounded-full bg-stone-300"></div>
                            <div class="w-1.5 h-1.5 rounded-full bg-stone-300"></div>
                            <div class="w-1.5 h-1.5 rounded-full bg-stone-300"></div>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-stone-800">日系20/26孔</div>
                            <div class="text-xs text-stone-500 mt-1">9.5mm均匀孔距 | B5(26孔)/A5(20孔)</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        

    </main>

    <!-- 页脚 -->
    <footer class="border-t border-stone-200 bg-stone-50 py-8 text-center text-sm text-stone-400">
        <p>数据综合整理自 @青藤小笺、@画个小画sunnyplan 与 @Sanagi Nankano</p>
        <p class="mt-2 text-xs">不同品牌存在1-3mm误差属正常范围，购买前请以实物内径为准</p>
    </footer>

    <script>
        // 手账数据
        const sizeData = [
            // TN 系列（定页）
            { id: 'tn-std', name: 'TN Standard', size: '110×210', type: 'tn', holes: 0, pitch: '-', system: 'TN定页', color: 'salt-orange', note: '与A5 Slim同尺寸(110×210)，定页+活页两用，可收纳A4三折页', compatible: ['a5s', 'a7', 'a8'] },
            { id: 'tn-pass', name: 'TN Passport', size: '90×125', type: 'tn', holes: 0, pitch: '-', system: 'TN定页', color: 'salt-blue', note: '便携旅行款，接近A7(80×120)，适合随身记录', compatible: ['a7'] },
            { id: 'tn-pocket', name: 'TN 随身款', size: '95×165', type: 'tn', holes: 0, pitch: '-', system: 'TN定页', color: 'salt-yellow', note: '与Personal同宽(95mm)，高度接近Personal(165 vs 170)，可搭配活页', compatible: ['personal', 'a6s', 'a8'] },

            // 大型
            { id: 'a5', name: 'A5', size: '144×210', type: 'large', holes: 6, pitch: '19-19-70-19-19', system: '欧美', color: 'salt-yellow', note: '标准尺寸，书写空间充裕，适合工作学习', fold2: '273×210', fold3: '406×210', compatible: ['a5s', 'a7', 'a8'] },
            { id: 'a5s', name: 'A5 Slim', size: '110×210', type: 'large', holes: 6, pitch: '19-19-70-19-19', system: '欧美', color: 'salt-green', note: '与A5同高，宽度窄34mm，更便携，可收纳A4三折页', fold2: '205×210', fold3: '304×210', compatible: ['a7', 'a8'] },
            { id: 'puo', name: 'PUO', size: '110×210', type: 'large', holes: 20, pitch: '9.5mm均匀', system: '日系', color: 'salt-blue', note: '20孔A5 Slim，可与TN标准本搭配', compatible: [] },
            
            // 中型 - Personal家族(170mm高)
            { id: 'a6s', name: 'A6 Slim', size: '80×170', type: 'medium', holes: 6, pitch: '19-19-50-19-19', system: '欧美', color: 'salt-purple', note: '80mm宽度家族，可放入Personal本皮', compatible: ['a8'] },
            { id: 'personal', name: 'A6 Personal', size: '95×170', type: 'medium', holes: 6, pitch: '19-19-50-19-19', system: '欧美', color: 'salt-pink', note: '⚡最常用尺寸，配件内页最丰富，新手首选', fold2: '177×170', fold3: '259×170', compatible: ['a6s', 'a8'] },
            { id: 'fc', name: 'A6 FC', size: '108×170', type: 'medium', holes: 6, pitch: '19-19-50-19-19', system: '欧美', color: 'salt-blue', note: '同Personal孔系，宽度递增', compatible: ['personal', 'a6s', 'a8'] },
            { id: 'pw', name: 'A6 PW', size: '120×170', type: 'medium', holes: 6, pitch: '19-19-50-19-19', system: '欧美', color: 'salt-green', note: '同Personal孔系', compatible: ['personal', 'a6s', 'a8'] },
            { id: 'square', name: 'A6 方方子', size: '150×170', type: 'medium', holes: 6, pitch: '19-19-50-19-19', system: '欧美', color: 'salt-yellow', note: '同孔系最宽，国内小众，原名HB×WA5', compatible: ['personal', 'fc', 'pw', 'a6s', 'a8'] },
            { id: 'a6weird', name: 'A6 奇葩', size: '105×148', type: 'medium', holes: 6, pitch: '19-19-38-19-19', system: '独立', color: 'salt-purple', note: '独特孔系，可兼容A7和M5内页，Smart三合一', fold2: '197×148', fold3: '289×148', compatible: ['a7', 'a8'] },
            
            // 小型
            { id: 'a7', name: 'A7', size: '80×120', type: 'small', holes: 6, pitch: '19-19-19-19-19', system: '欧美', color: 'salt-pink', note: 'Pocket尺寸，国外也称Pocket，便携首选', fold2: '148×120', fold3: '216×120', compatible: ['a8'] },
            { id: 'a7large', name: 'A7 大纸', size: '80×127', type: 'small', holes: 6, pitch: '19-19-19-19-19', system: '欧美', color: 'salt-blue', note: '比标准A7高7mm，缓解空间局促', compatible: ['a8'] },
            { id: 'a8', name: 'A8/M5(67)', size: '67×105', type: 'small', holes: 6, pitch: '19-19-19-19', system: 'M5', color: 'salt-green', note: '⚡M5中联动性最好的尺寸，可放入A7/奇葩', fold2: '123×105', fold3: '179×105', compatible: [] },
            { id: 'm5-62', name: 'M5 宽62', size: '62×105', type: 'small', holes: 6, pitch: '19mm', system: 'M5', color: 'salt-yellow', note: '更小巧的M5变体', compatible: [] },
            { id: 'm5-74', name: 'M5 宽74', size: '74×105', type: 'small', holes: 6, pitch: '19mm', system: 'M5', color: 'salt-purple', note: '更宽的M5变体，需确认本皮适配', compatible: [] },
            { id: 'm2.5', name: 'M2.5', size: '42×105', type: 'small', holes: 0, pitch: '-', system: '极小', color: 'salt-blue', note: '极小尺寸，配件极少，谨慎入坑', compatible: [] },
            { id: 'a9', name: 'A9', size: '60×78', type: 'small', holes: 3, pitch: '28-28', system: '独立', color: 'salt-yellow', note: '❌无法与其他尺寸联动，适合单独做迷你打卡本', compatible: [] },
        ];

        let currentView = 'grid';
        let currentFilter = 'all';
        const compareState = {
            orientation: 'portrait',
            scale: 0.65,
            reference: 'ref-a4',
            refShortMm: 210,
            itemPos: null,
            dragOffsetX: 0,
            dragOffsetY: 0
        };

        const referenceData = [
            { id: 'ref-a4', name: 'A4 打印纸', size: '210×297' },
            { id: 'ref-a5', name: 'A5 打印纸', size: '148×210' }
        ];

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            renderGrid();
            renderNestingChart();
            populateCalcOptions();
            populateCompareOptions();
            populateReferenceOptions();
            setupComparison();
            
            // 搜索监听
            document.getElementById('searchInput').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                filterBySearch(term);
            });
        });

        function renderGrid() {
            const grid = document.getElementById('sizeGrid');
            grid.innerHTML = '';
            
            const filtered = currentFilter === 'all' ? sizeData : 
                           currentFilter === 'compatible' ? sizeData.filter(d => d.compatible.length > 0) :
                           sizeData.filter(d => d.type === currentFilter);
            
            filtered.forEach(item => {
                const card = createCard(item);
                grid.appendChild(card);
            });
        }

        function createCard(item) {
            const div = document.createElement('div');
            div.className = `size-card ${item.color} rounded-2xl p-6 border-2 relative overflow-hidden paper-texture`;
            div.dataset.id = item.id;
            
            // 孔位可视化
            let holesHtml = '';
            if (item.holes > 0) {
                holesHtml = '<div class="absolute left-3 top-8 bottom-8 flex flex-col justify-between py-2">';
                for(let i=0; i<Math.min(item.holes, 6); i++) {
                    holesHtml += '<div class="binder-hole"></div>';
                }
                holesHtml += '</div>';
            } else {
                holesHtml = '<div class="absolute left-3 top-1/2 -translate-y-1/2 text-xs text-stone-400 font-medium" style="writing-mode: vertical-rl; letter-spacing: 2px;">定页</div>';
            }
            
            // 兼容标签
            const compatTags = item.compatible.map(c => {
                const target = sizeData.find(d => d.id === c);
                return `<span class="inline-block px-2 py-1 bg-white/80 rounded text-xs text-stone-600 border border-stone-200 mr-1 mb-1">${target?.name || c}</span>`;
            }).join('');
            
            div.innerHTML = `
                ${holesHtml}
                <div class="pl-6">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-bold text-stone-800 handwritten">${item.name}</h3>
                        <span class="text-xs px-2 py-1 rounded-full bg-white/60 border border-stone-200 text-stone-500">${item.system}</span>
                    </div>
                    
                    <div class="font-mono text-2xl font-medium text-stone-700 mb-2 tracking-tight">${item.size}<span class="text-sm text-stone-400 ml-1">mm</span></div>
                    
                    ${item.holes > 0 ? `
                    <div class="flex items-center gap-2 mb-3 text-xs text-stone-500">
                        <span class="flex items-center gap-1">
                            <div class="w-1.5 h-1.5 rounded-full bg-stone-400"></div>
                            ${item.holes}孔
                        </span>
                        <span>|</span>
                        <span>${item.pitch}</span>
                    </div>
                    ` : '<div class="mb-3 text-xs text-amber-600/80 font-medium">定页本 · 可搭配同尺寸活页</div>'}
                    
                    <p class="text-sm text-stone-600 mb-4 leading-relaxed">${item.note}</p>
                    
                    ${item.compatible.length > 0 ? `
                        <div class="border-t border-stone-300/50 pt-3 mt-3">
                            <div class="text-xs text-stone-400 mb-2">可收纳内页：</div>
                            <div class="flex flex-wrap">${compatTags}</div>
                        </div>
                    ` : ''}
                    
                    ${item.fold2 ? `
                        <div class="mt-3 pt-3 border-t border-stone-300/50 text-xs text-stone-500 grid grid-cols-2 gap-2">
                            <div>二折: ${item.fold2}</div>
                            <div>三折: ${item.fold3}</div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            div.onclick = () => showDetail(item);
            return div;
        }

        function renderNestingChart() {
            const chart = document.getElementById('nestingChart');
            chart.innerHTML = '';

            const items = [...sizeData].sort((a, b) => {
                const [aw, ah] = a.size.split('×').map(n => parseInt(n, 10));
                const [bw, bh] = b.size.split('×').map(n => parseInt(n, 10));
                const areaA = aw * ah;
                const areaB = bw * bh;
                if (areaB !== areaA) return areaB - areaA;
                return bh - ah;
            });

            items.forEach((item, index) => {
                const width = parseInt(item.size.split('×')[0], 10);
                const height = parseInt(item.size.split('×')[1], 10);
                const scale = 0.8;

                const div = document.createElement('div');
                div.className = 'relative cursor-pointer transition-all hover:-translate-y-1';
                div.style.width = `${width * scale}px`;
                div.style.height = `${height * scale}px`;
                div.style.minWidth = `${width * scale}px`;
                div.style.zIndex = 10 - index;

                div.innerHTML = `
                    <div class="w-full h-full ${item.color} nesting-rect border-2 border-stone-300 rounded shadow-sm flex flex-col items-center justify-center p-1 text-center">
                        <div class="text-[10px] font-bold text-stone-700 leading-tight">${item.name}</div>
                        <div class="text-[8px] text-stone-500 mt-1">${item.size}</div>
                    </div>
                `;

                div.onclick = () => highlightCompatible(item.id);
                chart.appendChild(div);
            });
        }

        function highlightCompatible(id) {
            const item = sizeData.find(d => d.id === id);
            if (!item || !item.compatible.length) return;
            
            // 高亮可收纳的尺寸
            document.querySelectorAll('.size-card').forEach(card => {
                card.style.opacity = '0.4';
                if (item.compatible.includes(card.dataset.id) || card.dataset.id === id) {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1.02)';
                    setTimeout(() => card.style.transform = '', 200);
                }
            });
            
            setTimeout(() => {
                document.querySelectorAll('.size-card').forEach(card => {
                    card.style.opacity = '1';
                });
            }, 2000);
        }

        function filterByType(type) {
            currentFilter = type;
            
            // 更新按钮状态
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.classList.add('bg-stone-800', 'text-white');
                    btn.classList.remove('bg-white', 'text-stone-600');
                } else {
                    btn.classList.remove('bg-stone-800', 'text-white');
                    btn.classList.add('bg-white', 'text-stone-600');
                }
            });
            
            renderGrid();
        }

        function filterBySearch(term) {
            const cards = document.querySelectorAll('.size-card');
            cards.forEach(card => {
                const item = sizeData.find(d => d.id === card.dataset.id);
                const match = item.name.toLowerCase().includes(term) || 
                             item.size.includes(term) || 
                             item.note.toLowerCase().includes(term);
                card.style.display = match ? 'block' : 'none';
            });
        }

        function toggleView(view) {
            currentView = view;
            const grid = document.getElementById('sizeGrid');
            if (view === 'table') {
                grid.className = 'space-y-2 mb-12';
                // 重新渲染为表格行
                grid.innerHTML = '';
                sizeData.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'paper-texture p-4 rounded-lg border border-stone-200 flex flex-wrap items-center gap-4 text-sm';
                    row.innerHTML = `
                        <div class="w-24 font-bold text-stone-800">${item.name}</div>
                        <div class="w-24 font-mono text-stone-600">${item.size}</div>
                        <div class="w-16 text-stone-500">${item.holes}孔</div>
                        <div class="w-32 text-stone-400 text-xs">${item.pitch}</div>
                        <div class="flex-1 text-stone-600">${item.note}</div>
                    `;
                    grid.appendChild(row);
                });
            } else {
                grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12';
                renderGrid();
            }
        }

        function populateCalcOptions() {
            const select = document.getElementById('calcSize');
            sizeData.filter(d => d.fold2).forEach(item => {
                const opt = document.createElement('option');
                opt.value = JSON.stringify({w: item.size.split('×')[0], h: item.size.split('×')[1]});
                opt.textContent = `${item.name} (${item.size})`;
                select.appendChild(opt);
            });
        }

        function populateCompareOptions() {
            const select = document.getElementById('compareSize');
            if (!select) return;
            sizeData.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = `${item.name} (${item.size})`;
                select.appendChild(opt);
            });
        }

        function populateReferenceOptions() {
            const select = document.getElementById('referenceSelect');
            if (!select) return;

            const paperGroup = document.createElement('optgroup');
            paperGroup.label = '打印纸参照';
            referenceData.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = `${item.name} (${item.size})`;
                paperGroup.appendChild(opt);
            });
            select.appendChild(paperGroup);

            const sizeGroup = document.createElement('optgroup');
            sizeGroup.label = '手账尺寸';
            sizeData.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = `${item.name} (${item.size})`;
                sizeGroup.appendChild(opt);
            });
            select.appendChild(sizeGroup);

            select.value = compareState.reference;
        }

        function setupComparison() {
            const select = document.getElementById('compareSize');
            if (!select) return;

            select.addEventListener('change', () => {
                compareState.itemPos = null;
                updateComparison();
            });

            const item = document.getElementById('compareItem');
            if (item) {
                item.addEventListener('pointerdown', startDragCompare);
                item.addEventListener('pointermove', onDragCompare);
                item.addEventListener('pointerup', endDragCompare);
                item.addEventListener('pointercancel', endDragCompare);
            }

            const refSelect = document.getElementById('referenceSelect');
            if (refSelect) {
                refSelect.addEventListener('change', () => {
                    if (refSelect.value) {
                        setReferenceType(refSelect.value);
                    }
                });
            }

            setReferenceType(compareState.reference);
            updateA4Sheet();
            window.addEventListener('resize', () => {
                updateA4Sheet(true);
                updateComparison(true);
            });
        }

        function getReferenceConfig(id) {
            const paper = referenceData.find(ref => ref.id === id);
            if (paper) {
                const [w, h] = paper.size.split('×').map(n => parseInt(n, 10));
                const short = Math.min(w, h);
                const long = Math.max(w, h);
                return {
                    name: paper.name,
                    label: paper.name,
                    short,
                    long
                };
            }

            const item = sizeData.find(d => d.id === id);
            if (item) {
                const [w, h] = item.size.split('×').map(n => parseInt(n, 10));
                const short = Math.min(w, h);
                const long = Math.max(w, h);
                return {
                    name: item.name,
                    label: item.name,
                    short,
                    long
                };
            }

            const fallback = referenceData[0];
            return {
                name: fallback.name,
                label: fallback.name,
                short: 210,
                long: 297
            };
        }

        function setReferenceType(id) {
            compareState.reference = id;
            const refSelect = document.getElementById('referenceSelect');
            if (refSelect && refSelect.value !== id) {
                refSelect.value = id;
            }
            compareState.itemPos = null;
            updateA4Sheet();
            updateComparison();
        }

        function setA4Orientation(orientation) {
            compareState.orientation = orientation;
            const btnPortrait = document.getElementById('btnA4Portrait');
            const btnLandscape = document.getElementById('btnA4Landscape');

            if (btnPortrait && btnLandscape) {
                if (orientation === 'portrait') {
                    btnPortrait.classList.add('bg-stone-800', 'text-white');
                    btnPortrait.classList.remove('bg-white', 'text-stone-600');
                    btnLandscape.classList.remove('bg-stone-800', 'text-white');
                    btnLandscape.classList.add('bg-white', 'text-stone-600');
                } else {
                    btnLandscape.classList.add('bg-stone-800', 'text-white');
                    btnLandscape.classList.remove('bg-white', 'text-stone-600');
                    btnPortrait.classList.remove('bg-stone-800', 'text-white');
                    btnPortrait.classList.add('bg-white', 'text-stone-600');
                }
            }

            compareState.itemPos = null;
            updateA4Sheet();
            updateComparison();
        }

        function updateA4Sheet(keepPosition = false) {
            const canvas = document.getElementById('comparisonCanvas');
            const a4 = document.getElementById('a4Sheet');
            if (!canvas || !a4) return;

            const canvasWidth = canvas.clientWidth || 320;
            const shortEdgePx = Math.min(190, Math.max(130, canvasWidth * 0.45));
            const ref = getReferenceConfig(compareState.reference);
            const longEdgePx = shortEdgePx * (ref.long / ref.short);

            const isPortrait = compareState.orientation === 'portrait';
            const a4Width = isPortrait ? shortEdgePx : longEdgePx;
            const a4Height = isPortrait ? longEdgePx : shortEdgePx;

            a4.style.width = `${a4Width}px`;
            a4.style.height = `${a4Height}px`;

            const nameLabel = document.getElementById('referenceSheetName');
            const sizeLabel = document.getElementById('referenceSheetSize');
            if (nameLabel) {
                nameLabel.textContent = ref.name;
            }
            if (sizeLabel) {
                sizeLabel.textContent = isPortrait ? `${ref.short}×${ref.long}` : `${ref.long}×${ref.short}`;
            }
            const legend = document.getElementById('referenceLegendText');
            if (legend) {
                legend.textContent = `${ref.label}（${isPortrait ? ref.short + '×' + ref.long : ref.long + '×' + ref.short} mm）`;
            }

            compareState.refShortMm = ref.short;
            compareState.scale = shortEdgePx / ref.short;
            if (!keepPosition) {
                compareState.itemPos = null;
            }
        }

        function syncScaleFromA4() {
            const a4 = document.getElementById('a4Sheet');
            if (!a4) return;
            const rect = a4.getBoundingClientRect();
            const shortEdgePx = Math.min(rect.width, rect.height);
            if (shortEdgePx > 0) {
                compareState.scale = shortEdgePx / compareState.refShortMm;
            }
        }

        function updateComparison(keepPosition = false) {
            const select = document.getElementById('compareSize');
            const itemEl = document.getElementById('compareItem');
            if (!select || !itemEl) return;

            if (!select.value) {
                itemEl.classList.add('hidden');
                return;
            }

            const item = sizeData.find(d => d.id === select.value);
            if (!item) return;

            // Always derive scale from the actual A4 display size
            syncScaleFromA4();

            const [wStr, hStr] = item.size.split('×');
            const width = parseInt(wStr, 10);
            const height = parseInt(hStr, 10);
            const displayWidth = width * compareState.scale;
            const displayHeight = height * compareState.scale;

            itemEl.style.width = `${displayWidth}px`;
            itemEl.style.height = `${displayHeight}px`;
            itemEl.innerHTML = `
                <div class="text-center p-2 leading-tight">
                    <div class="text-xs font-bold text-stone-900 mb-0.5">${item.name}</div>
                    <div class="text-[10px] text-stone-700 font-mono">${item.size}</div>
                </div>
            `;
            itemEl.classList.remove('hidden');

            if (!compareState.itemPos || !keepPosition) {
                centerCompareItem();
            } else {
                setCompareItemPosition(compareState.itemPos.x, compareState.itemPos.y);
            }
        }

        function centerCompareItem() {
            const canvas = document.getElementById('comparisonCanvas');
            const a4 = document.getElementById('a4Sheet');
            const itemEl = document.getElementById('compareItem');
            if (!canvas || !a4 || !itemEl) return;

            const canvasRect = canvas.getBoundingClientRect();
            const a4Rect = a4.getBoundingClientRect();
            const itemRect = itemEl.getBoundingClientRect();

            const left = a4Rect.left - canvasRect.left + (a4Rect.width - itemRect.width) / 2;
            const top = a4Rect.top - canvasRect.top + (a4Rect.height - itemRect.height) / 2;
            setCompareItemPosition(left, top);
        }

        function resetComparePosition() {
            compareState.itemPos = null;
            centerCompareItem();
        }

        function setCompareItemPosition(x, y) {
            const itemEl = document.getElementById('compareItem');
            if (!itemEl) return;
            itemEl.style.left = `${x}px`;
            itemEl.style.top = `${y}px`;
            compareState.itemPos = { x, y };
        }

        function startDragCompare(event) {
            const itemEl = document.getElementById('compareItem');
            if (!itemEl || itemEl.classList.contains('hidden')) return;
            itemEl.classList.add('dragging');
            itemEl.setPointerCapture(event.pointerId);

            const rect = itemEl.getBoundingClientRect();
            compareState.dragOffsetX = event.clientX - rect.left;
            compareState.dragOffsetY = event.clientY - rect.top;
        }

        function onDragCompare(event) {
            const itemEl = document.getElementById('compareItem');
            const canvas = document.getElementById('comparisonCanvas');
            if (!itemEl || !canvas || !itemEl.classList.contains('dragging')) return;

            const canvasRect = canvas.getBoundingClientRect();
            const margin = 60;
            const newLeft = event.clientX - canvasRect.left - compareState.dragOffsetX;
            const newTop = event.clientY - canvasRect.top - compareState.dragOffsetY;

            const maxLeft = canvasRect.width - itemEl.offsetWidth + margin;
            const maxTop = canvasRect.height - itemEl.offsetHeight + margin;
            const clampedLeft = Math.max(-margin, Math.min(maxLeft, newLeft));
            const clampedTop = Math.max(-margin, Math.min(maxTop, newTop));

            setCompareItemPosition(clampedLeft, clampedTop);
        }

        function endDragCompare(event) {
            const itemEl = document.getElementById('compareItem');
            if (!itemEl) return;
            itemEl.classList.remove('dragging');
            if (event.pointerId !== undefined) {
                itemEl.releasePointerCapture(event.pointerId);
            }
        }

        function calcFold(type) {
            const select = document.getElementById('calcSize');
            if (!select.value) return;
            
            const dims = JSON.parse(select.value);
            const w = parseInt(dims.w);
            const h = parseInt(dims.h);
            
            let result = '';
            if (type === 'bifold') {
                const foldW = Math.round(w * 2);
                result = `二折页尺寸：<span class="font-mono font-bold text-stone-800 text-lg">${foldW}×${h}mm</span><br><span class="text-xs text-stone-400">折叠后：${w}×${h}mm</span>`;
            } else {
                const foldW = Math.round(w * 3);
                result = `三折页尺寸：<span class="font-mono font-bold text-stone-800 text-lg">${foldW}×${h}mm</span><br><span class="text-xs text-stone-400">折叠后：${w}×${h}mm (每折约${Math.round(w/3*10)/10}cm)</span>`;
            }
            
            const resDiv = document.getElementById('calcResult');
            resDiv.innerHTML = result;
            resDiv.classList.remove('hidden');
        }

        function showDetail(item) {
            // 简单的详情展示，可以扩展为模态框
            console.log('Detail:', item);
        }
    </script>
</body>
</html>

